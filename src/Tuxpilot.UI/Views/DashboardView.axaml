<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="using:Tuxpilot.UI.Converters"
             xmlns:vm="using:Tuxpilot.UI.ViewModels"
             x:Class="Tuxpilot.UI.Views.DashboardView"
             x:DataType="vm:DashboardViewModel">

    <Design.DataContext>
        <vm:DashboardViewModel/>
    </Design.DataContext>

    <UserControl.Resources>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:BoolToTextConverter x:Key="BoolToTextConverter"/>
    </UserControl.Resources>
    
  <ScrollViewer>
        <StackPanel Margin="32" Spacing="24">
            
            <!-- ðŸ§ Header avec logo -->
            <StackPanel Orientation="Horizontal" Spacing="16">
                <TextBlock Text="ðŸ§" FontSize="48" VerticalAlignment="Center"/>
                <StackPanel VerticalAlignment="Center" Spacing="4">
                    <TextBlock Classes="text-h1" Text="Tuxpilot"/>
                    <TextBlock Classes="text-muted" Text="Assistant Linux pour dÃ©butants et collectivitÃ©s"/>
                </StackPanel>
            </StackPanel>
            
            <!-- Indicateur de chargement -->
            <ProgressBar IsIndeterminate="True"
                        IsVisible="{Binding IsLoading}"
                        Height="4"/>
            
            <!-- ðŸ†• SUGGESTION PROACTIVE IA -->
            <Border Grid.Row="0"
                    IsVisible="{Binding HasSuggestion}"
                    Background="#DBEAFE"
                    CornerRadius="12"
                    Padding="20"
                    Margin="32,16,32,16"
                    BorderBrush="#3B82F6"
                    BorderThickness="2">
                <Grid ColumnDefinitions="Auto,*,Auto">
        
                    <!-- IcÃ´ne -->
                    <Border Grid.Column="0"
                            Width="48" Height="48"
                            CornerRadius="24"
                            Background="#3B82F6"
                            VerticalAlignment="Top">
                        <TextBlock Text="ðŸ¤–" 
                                   FontSize="24"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Border>
        
                    <!-- Message -->
                    <StackPanel Grid.Column="1" 
                                Margin="16,0,0,0"
                                VerticalAlignment="Center"
                                Spacing="8">
                        <TextBlock Classes="text-h3"
                                   Text="ðŸ’¡ Suggestion de l'IA"
                                   Foreground="#1E40AF"/>
                        <TextBlock Classes="text-body"
                                   Text="{Binding SuggestionIA}"
                                   TextWrapping="Wrap"
                                   Foreground="#1E3A8A"/>
                    </StackPanel>
        
                    <!-- Bouton fermer -->
                    <Button Grid.Column="2"
                            Classes="btn-secondary btn-sm"
                            Content="âœ•"
                            Command="{Binding FermerSuggestionCommand}"
                            VerticalAlignment="Top"
                            Width="32" Height="32"
                            Padding="0"/>
        
                </Grid>
            </Border>
            
            <!-- Info derniÃ¨re mise Ã  jour -->
            <Border Background="#F0F9FF"
                    CornerRadius="8"
                    Padding="12,10"
                    BorderBrush="#BAE6FD"
                    BorderThickness="1">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="ðŸ”„"
                               FontSize="16"
                               VerticalAlignment="Center"/>
                    <TextBlock Classes="text-sm text-info"
                               Text="{Binding TimeSinceLastRefresh}"
                               VerticalAlignment="Center"/>
                    <TextBlock Classes="text-sm text-muted"
                               Text="â€¢ Actualisation automatique toutes les 10s"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
            
            <!-- ðŸ†• HISTORIQUE DES ACTIONS -->
<Border Background="White"
        CornerRadius="12"
        Padding="20"
        BorderBrush="#E5E7EB"
        BorderThickness="1">
    <StackPanel Spacing="16">
        
        <!-- Header -->
        <Grid ColumnDefinitions="*,Auto">
            <TextBlock Grid.Column="0"
                      Classes="text-h3"
                      Text="ðŸ“‹ DerniÃ¨res actions"/>
            <Button Grid.Column="1"
                    Classes="btn-outline btn-sm"
                    Content="ðŸ”„"
                    Command="{Binding ChargerHistoriqueCommand}"
                    ToolTip.Tip="Actualiser"/>
        </Grid>
        
        <!-- Liste des actions -->
        <ItemsControl ItemsSource="{Binding DernieresActions}">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Background="#F9FAFB"
                            CornerRadius="8"
                            Padding="12"
                            Margin="0,0,0,8">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            
                            <!-- IcÃ´ne -->
                            <TextBlock Grid.Column="0"
                                      Text="{Binding Icone}"
                                      FontSize="20"
                                      VerticalAlignment="Center"
                                      Margin="0,0,12,0"/>
                            
                            <!-- Description -->
                            <StackPanel Grid.Column="1" Spacing="4">
                                <TextBlock Classes="text-body"
                                          Text="{Binding Description}"
                                          FontWeight="Medium"/>
                                <TextBlock Classes="text-sm text-muted"
                                          Text="{Binding DateFormatee}"/>
                            </StackPanel>
                            
                            <!-- Statut -->
                            <Border Grid.Column="2"
                                    Background="{Binding Success, Converter={StaticResource BoolToColorConverter}}"
                                    CornerRadius="12"
                                    Padding="8,4"
                                    VerticalAlignment="Center">
                                <TextBlock Classes="text-sm"
                                          Text="{Binding Success, Converter={StaticResource BoolToTextConverter}}"
                                          Foreground="White"
                                          FontWeight="SemiBold"/>
                            </Border>
                            
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
        
        <!-- Message si vide -->
        <TextBlock Classes="text-muted"
                  Text="Aucune action enregistrÃ©e pour le moment"
                  HorizontalAlignment="Center"
                  Margin="0,8,0,0">
            <TextBlock.IsVisible>
                <MultiBinding Converter="{x:Static BoolConverters.And}">
                    <Binding Path="DernieresActions.Count"/>
                    <Binding Source="0"/>
                </MultiBinding>
            </TextBlock.IsVisible>
        </TextBlock>
        
    </StackPanel>
</Border>

            
            <!-- Informations systÃ¨me -->
            <Border Background="White"
                    CornerRadius="12"
                    Padding="24"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1">
                <StackPanel Spacing="20">
                    
                    <TextBlock Text="â„¹ï¸ Informations systÃ¨me" 
                              FontSize="18" 
                              FontWeight="SemiBold"/>
                    
                    <!-- Distribution -->
                    <StackPanel Spacing="4">
                        <TextBlock Classes="text-label" Text="Distribution"/>
                        <TextBlock Classes="text-value" Text="{Binding SystemInfo.Distribution}"/>
                    </StackPanel>
                    
                    <!-- Kernel -->
                    <StackPanel Spacing="4">
                        <TextBlock Classes="text-label" Text="Kernel"/>
                        <TextBlock Classes="text-value" Text="{Binding SystemInfo.KernelVersion}"/>
                    </StackPanel>
                    
                    <!-- Gestionnaire de paquets -->
                    <StackPanel Spacing="4">
                        <TextBlock Classes="text-label" Text="Gestionnaire de paquets"/>
                        <TextBlock Classes="text-value" Text="{Binding SystemInfo.PackageManager}"/>
                    </StackPanel>
                    
                    <!-- Processeur -->
                    <StackPanel Spacing="4">
                        <TextBlock Classes="text-label" Text="Processeur"/>
                        <TextBlock Classes="text-value" Text="{Binding SystemInfo.CpuModel}"/>
                        <TextBlock Classes="text-muted">
                            <Run Text="{Binding SystemInfo.CpuCores}"/>
                            <Run Text=" cÅ“urs â€¢ "/>
                            <Run Text="{Binding SystemInfo.CpuThreads}"/>
                            <Run Text=" threads"/>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- Utilisation des ressources -->
            <Border Background="White"
                    CornerRadius="12"
                    Padding="24"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1">
                <StackPanel Spacing="20">
                    
                    <TextBlock Classes="text-h2" Text="ðŸ“Š Utilisation des ressources"/>
                    
                    <!-- RAM avec couleur dynamique -->
                    <StackPanel Spacing="8">
                        <Grid ColumnDefinitions="*,Auto">
                            
                            <TextBlock Grid.Column="0" Classes="text-body" Text="MÃ©moire RAM"/>
                            <TextBlock Grid.Column="1" Classes="text-metric" 
                                       Text="{Binding SystemInfo.RamUsageText}"
                                       Foreground="{Binding SystemInfo.RamColor}"/>
                        </Grid>
                        <ProgressBar Value="{Binding SystemInfo.RamPercent}" 
                                    Maximum="100"
                                    Height="12"
                                    CornerRadius="6"
                                    Foreground="{Binding SystemInfo.RamColor}"/>
                    </StackPanel>
                    
                    <!-- CPU avec couleur dynamique -->
                    <StackPanel Spacing="8">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0" Classes="text-body" Text="Processeur (CPU)"/>
                            <TextBlock Grid.Column="1" Classes="text-metric" 
                                       Text="{Binding SystemInfo.CpuUsageText}"
                                       Foreground="{Binding SystemInfo.CpuColor}"/>
                        </Grid>
                        <ProgressBar Value="{Binding SystemInfo.CpuPercent}" 
                                    Maximum="100"
                                    Height="12"
                                    CornerRadius="6"
                                    Foreground="{Binding SystemInfo.CpuColor}"/>
                    </StackPanel>
                    
                    <!-- Disque avec couleur dynamique -->
                    <StackPanel Spacing="8">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0" Classes="text-body" Text="Espace disque"/>
                            <TextBlock Grid.Column="1" Classes="text-metric" 
                                       Text="{Binding SystemInfo.DiskUsageText}"
                                       Foreground="{Binding SystemInfo.DiskColor}"/>
                        </Grid>
                        <ProgressBar Value="{Binding SystemInfo.DiskPercent}" 
                                    Maximum="100"
                                    Height="12"
                                    CornerRadius="6"
                                    Foreground="{Binding SystemInfo.DiskColor}"/>
                    </StackPanel>
                    
                    <!-- Bouton actualiser -->
                    <Button Classes="btn-primary"
                             Content="ðŸ”„ Actualiser"
                             Command="{Binding RefreshCommand}"
                             HorizontalAlignment="Left"
                             Margin="0,8,0,0"/>
                    
                    <!-- ðŸ†• Bouton Demander conseil -->
                    <Button Classes="btn-primary"
                            Content="ðŸ’¡ Demander conseil"
                            Command="{Binding AnalyserSystemeCommand}"
                            IsEnabled="{Binding !IsAnalyzing}"
                            HorizontalAlignment="Left"
                            Margin="12,8,0,0">
                        <Button.Styles>
                            <Style Selector="Button[IsEnabled=False]">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                    <!-- Indicateur de chargement IA -->
                    <TextBlock Classes="text-sm text-info"
                               Text="ðŸ”„ Analyse en cours..."
                               IsVisible="{Binding IsAnalyzing}"
                               VerticalAlignment="Center"
                               Margin="12,8,0,0"/>
                </StackPanel>
            </Border>
            
            <!-- Message de statut -->
            <Border Background="#EFF6FF"
                    CornerRadius="8"
                    Padding="16"
                    BorderBrush="#3B82F6"
                    BorderThickness="2"
                    IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                <TextBlock Classes="text-body" 
                           Text="{Binding StatusMessage}" 
                           FontWeight="Medium"
                           Foreground="#1E40AF"/>
            </Border>
            
        </StackPanel>
    </ScrollViewer>
</UserControl>