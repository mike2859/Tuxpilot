<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Tuxpilot.UI.ViewModels"
             x:Class="Tuxpilot.UI.Views.ServicesView"
             x:DataType="vm:ServicesViewModel">

    <Design.DataContext>
        <vm:ServicesViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="32,32,32,16">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0" Spacing="8">
                    <TextBlock Classes="text-h1"
                              Text="âš™ï¸ Services systÃ¨me"/>
                    <TextBlock Classes="text-muted"
                              Text="GÃ©rez les services systemd de votre systÃ¨me"/>
                </StackPanel>
                
                <Button Grid.Column="1"
                        Classes="btn-primary"
                        Content="ðŸ”„ Actualiser"
                        Command="{Binding ChargerServicesCommand}"
                        VerticalAlignment="Top"/>
            </Grid>
            
            <!-- Message statut -->
            <Border Background="{DynamicResource BackgroundTertiary}"
                    CornerRadius="8"
                    Padding="12"
                    IsVisible="{Binding MessageStatut, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                <TextBlock Classes="text-body"
                          Text="{Binding MessageStatut}"
                          FontWeight="Medium"/>
            </Border>
        </StackPanel>
        
        <!-- Contenu principal -->
        <Grid Grid.Row="1" Margin="32,0,32,16" ColumnDefinitions="350,*">
            
            <!-- Liste des services (gauche) -->
            <Border Grid.Column="0"
                    Background="{DynamicResource BackgroundPrimary}"
                    CornerRadius="12"
                    BorderBrush="{DynamicResource BorderPrimary}"
                    BorderThickness="1"
                    Margin="0,0,8,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Services}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        Padding="16,12"
                                        Command="{Binding $parent[ItemsControl].((vm:ServicesViewModel)DataContext).SelectionnerServiceCommand}"
                                        CommandParameter="{Binding}"
                                        Cursor="Hand">
                                    <Button.Styles>
                                        <Style Selector="Button:pointerover">
                                            <Setter Property="Background" Value="#F9FAFB"/>
                                        </Style>
                                    </Button.Styles>
                                    
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- IcÃ´ne statut -->
                                        <TextBlock Grid.Column="0"
                                                  Text="{Binding StatusIcon}"
                                                  FontSize="20"
                                                  VerticalAlignment="Center"/>
                                        
                                        <!-- Nom et info -->
                                        <StackPanel Grid.Column="1" 
                                                   Margin="12,0,0,0"
                                                   Spacing="4">
                                            <TextBlock Classes="text-body"
                                                      Text="{Binding Name}"
                                                      FontWeight="SemiBold"/>
                                            <TextBlock Classes="text-sm"
                                                      Text="{Binding EnabledText}"/>
                                        </StackPanel>
                                        
                                        <!-- Badge statut -->
                                        <Border Grid.Column="2"
                                                Background="{Binding StatusColor}"
                                                CornerRadius="8"
                                                Padding="8,4"
                                                VerticalAlignment="Center">
                                            <TextBlock Classes="text-sm"
                                                      Text="{Binding StatusText}"
                                                      Foreground="White"
                                                      FontWeight="SemiBold"/>
                                        </Border>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
            
           <!-- DÃ©tails du service (droite) -->
<Border Grid.Column="1"
        Background="{DynamicResource BackgroundPrimary}"
        CornerRadius="12"
        BorderBrush="{DynamicResource BorderPrimary}"
        BorderThickness="1"
        Margin="8,0,0,0">
    
    <!-- ðŸ†• UN SEUL Grid parent -->
    <Grid>
        
        <!-- DÃ©tails du service sÃ©lectionnÃ© -->
        <Grid RowDefinitions="Auto,*" 
              IsVisible="{Binding ServiceSelectionne, Converter={x:Static ObjectConverters.IsNotNull}}">
            
            <!-- Header avec actions -->
            <Border Grid.Row="0"
                    Background="{DynamicResource BackgroundSecondary}"
                    BorderBrush="{DynamicResource BorderPrimary}"
                    BorderThickness="0,0,0,1"
                    Padding="24">
                <Grid RowDefinitions="Auto,Auto">
                    <!-- Info service -->
                    <StackPanel Grid.Row="0" Spacing="8">
                        <Grid ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0"
                                      Text="{Binding ServiceSelectionne.StatusIcon}"
                                      FontSize="32"
                                      VerticalAlignment="Center"
                                      Margin="0,0,16,0"/>
                            <StackPanel Grid.Column="1" Spacing="4">
                                <TextBlock Classes="text-h2"
                                          Text="{Binding ServiceSelectionne.Name}"/>
                                <TextBlock Classes="text-muted"
                                          Text="{Binding ServiceSelectionne.Unit}"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                    
                    <!-- Boutons d'action -->
                    <StackPanel Grid.Row="1" 
                               Orientation="Horizontal" 
                               Spacing="8"
                               Margin="0,16,0,0">
                        <Button Classes="btn-primary"
                                Content="â–¶ï¸ DÃ©marrer"
                                Command="{Binding DemarrerServiceCommand}"
                                IsEnabled="{Binding !IsExecutingAction}"/>
                        
                        <Button Classes="btn-danger"
                                Content="â¹ï¸ ArrÃªter"
                                Command="{Binding ArreterServiceCommand}"
                                IsEnabled="{Binding !IsExecutingAction}"/>
                        
                        <Button Classes="btn-secondary"
                                Content="ðŸ”„ RedÃ©marrer"
                                Command="{Binding RedemarrerServiceCommand}"
                                IsEnabled="{Binding !IsExecutingAction}"/>
                        
                        <Button Classes="btn-outline"
                                Content="ðŸ“‹ RafraÃ®chir logs"
                                Command="{Binding ChargerLogsCommand}"
                                IsEnabled="{Binding !IsLoadingLogs}"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Zone de logs -->
            <ScrollViewer Grid.Row="1" 
                         Padding="24"
                         VerticalScrollBarVisibility="Auto">
                <Border Background="#1E1E1E"
                        CornerRadius="8"
                        Padding="16">
                    <TextBlock Classes="text-sm"
                              Text="{Binding Logs}"
                              Foreground="#D4D4D4"
                              FontFamily="monospace"
                              TextWrapping="Wrap"/>
                </Border>
            </ScrollViewer>
        </Grid>
        
        <!-- Message si aucun service sÃ©lectionnÃ© -->
        <StackPanel IsVisible="{Binding ServiceSelectionne, Converter={x:Static ObjectConverters.IsNull}}"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Center"
                   Spacing="16">
            <TextBlock Text="ðŸ“‹" 
                      FontSize="64"
                      HorizontalAlignment="Center"/>
            <TextBlock Classes="text-h2"
                      Text="SÃ©lectionnez un service"
                      HorizontalAlignment="Center"/>
            <TextBlock Classes="text-muted"
                      Text="Cliquez sur un service dans la liste pour voir ses dÃ©tails"
                      HorizontalAlignment="Center"/>
        </StackPanel>
        
    </Grid>
    
</Border>
            
        </Grid>
        
    </Grid>

</UserControl>